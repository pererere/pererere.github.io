<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FoodLink: Connector</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FoodLink
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__d_1_2_g_i_t_2_food_link_2foodlink_8client_2node__modules_2undici_2docs_2api_2_connector.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Connector</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md21287"></a></p>
<p>Undici creates the underlying socket via the connector builder. Normally, this happens automatically and you don't need to care about this, but if you need to perform some additional check over the currently used socket, this is the right place.</p>
<p>If you want to create a custom connector, you must import the <code>buildConnector</code> utility.</p>
<h3><a class="anchor" id="autotoc_md21288"></a>
Parameter: <code>buildConnector.BuildOptions</code></h3>
<p>Every Tls option, see <a href="https://nodejs.org/api/tls.html#tls_tls_connect_options_callback">here</a>. Furthermore, the following options can be passed:</p>
<ul>
<li><b>socketPath</b> <code>string | null</code> (optional) - Default: <code>null</code> - An IPC endpoint, either Unix domain socket or Windows named pipe.</li>
<li><b>maxCachedSessions</b> <code>number | null</code> (optional) - Default: <code>100</code> - Maximum number of TLS cached sessions. Use 0 to disable TLS session caching. Default: <code>100</code>.</li>
<li><b>timeout</b> <code>number | null</code> (optional) - In milliseconds. Default <code>10e3</code>.</li>
<li><b>servername</b> <code>string | null</code> (optional)</li>
</ul>
<p>Once you call <code>buildConnector</code>, it will return a connector function, which takes the following parameters.</p>
<h3><a class="anchor" id="autotoc_md21289"></a>
Parameter: <code>connector.Options</code></h3>
<ul>
<li><b>hostname</b> <code>string</code> (required)</li>
<li><b>host</b> <code>string</code> (optional)</li>
<li><b>protocol</b> <code>string</code> (required)</li>
<li><b>port</b> <code>string</code> (required)</li>
<li><b>servername</b> <code>string</code> (optional)</li>
<li><b>localAddress</b> <code>string | null</code> (optional) Local address the socket should connect from.</li>
<li><b>httpSocket</b> <code>Socket</code> (optional) Establish secure connection on a given socket rather than creating a new socket. It can only be sent on TLS update.</li>
</ul>
<h2><a class="anchor" id="autotoc_md21290"></a>
Basic example</h2>
<div class="fragment"><div class="line">&#39;use strict&#39;</div>
<div class="line"> </div>
<div class="line">import { Client, buildConnector } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const connector = buildConnector({ rejectUnauthorized: false })</div>
<div class="line">const client = new Client(&#39;https://localhost:3000&#39;, {</div>
<div class="line">  connect (opts, cb) {</div>
<div class="line">    connector(opts, (err, socket) =&gt; {</div>
<div class="line">      if (err) {</div>
<div class="line">        cb(err)</div>
<div class="line">      } else if (/* assertion */) {</div>
<div class="line">        socket.destroy()</div>
<div class="line">        cb(new Error(&#39;kaboom&#39;))</div>
<div class="line">      } else {</div>
<div class="line">        cb(null, socket)</div>
<div class="line">      }</div>
<div class="line">    })</div>
<div class="line">  }</div>
<div class="line">})</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21291"></a>
Example: validate the CA fingerprint</h2>
<div class="fragment"><div class="line">&#39;use strict&#39;</div>
<div class="line"> </div>
<div class="line">import { Client, buildConnector } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const caFingerprint = &#39;FO:OB:AR&#39;</div>
<div class="line">const connector = buildConnector({ rejectUnauthorized: false })</div>
<div class="line">const client = new Client(&#39;https://localhost:3000&#39;, {</div>
<div class="line">  connect (opts, cb) {</div>
<div class="line">    connector(opts, (err, socket) =&gt; {</div>
<div class="line">      if (err) {</div>
<div class="line">        cb(err)</div>
<div class="line">      } else if (getIssuerCertificate(socket).fingerprint256 !== caFingerprint) {</div>
<div class="line">        socket.destroy()</div>
<div class="line">        cb(new Error(&#39;Fingerprint does not match or malformed certificate&#39;))</div>
<div class="line">      } else {</div>
<div class="line">        cb(null, socket)</div>
<div class="line">      }</div>
<div class="line">    })</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">client.request({</div>
<div class="line">  path: &#39;/&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}, (err, data) =&gt; {</div>
<div class="line">  if (err) throw err</div>
<div class="line"> </div>
<div class="line">  const bufs = []</div>
<div class="line">  data.body.on(&#39;data&#39;, (buf) =&gt; {</div>
<div class="line">    bufs.push(buf)</div>
<div class="line">  })</div>
<div class="line">  data.body.on(&#39;end&#39;, () =&gt; {</div>
<div class="line">    console.log(Buffer.concat(bufs).toString(&#39;utf8&#39;))</div>
<div class="line">    client.close()</div>
<div class="line">  })</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">function getIssuerCertificate (socket) {</div>
<div class="line">  let certificate = socket.getPeerCertificate(true)</div>
<div class="line">  while (certificate &amp;&amp; Object.keys(certificate).length &gt; 0) {</div>
<div class="line">    // invalid certificate</div>
<div class="line">    if (certificate.issuerCertificate == null) {</div>
<div class="line">      return null</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // We have reached the root certificate.</div>
<div class="line">    // In case of self-signed certificates, `issuerCertificate` may be a circular reference.</div>
<div class="line">    if (certificate.fingerprint256 === certificate.issuerCertificate.fingerprint256) {</div>
<div class="line">      break</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // continue the loop</div>
<div class="line">    certificate = certificate.issuerCertificate</div>
<div class="line">  }</div>
<div class="line">  return certificate</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
