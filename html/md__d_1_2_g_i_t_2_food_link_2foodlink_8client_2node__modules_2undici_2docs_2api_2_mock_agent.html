<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FoodLink: Class: MockAgent</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FoodLink
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__d_1_2_g_i_t_2_food_link_2foodlink_8client_2node__modules_2undici_2docs_2api_2_mock_agent.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Class: MockAgent</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md21372"></a></p>
<p>Extends: <code>undici.Dispatcher</code></p>
<p>A mocked Agent class that implements the Agent API. It allows one to intercept HTTP requests made through undici and return mocked responses instead.</p>
<h1><a class="anchor" id="autotoc_md21373"></a>
<code>new MockAgent([options])</code></h1>
<p>Arguments:</p>
<ul>
<li><b>options</b> <code>MockAgentOptions</code> (optional) - It extends the <code>Agent</code> options.</li>
</ul>
<p>Returns: <code>MockAgent</code></p>
<h2><a class="anchor" id="autotoc_md21374"></a>
Parameter: <code>MockAgentOptions</code></h2>
<p>Extends: <a href="Agent.md#parameter-agentoptions"><code>AgentOptions</code></a></p>
<ul>
<li><b>agent</b> <code>Agent</code> (optional) - Default: <code>new Agent([options])</code> - a custom agent encapsulated by the MockAgent.</li>
</ul>
<h2><a class="anchor" id="autotoc_md21375"></a>
Example - Basic MockAgent instantiation</h2>
<p>This will instantiate the MockAgent. It will not do anything until registered as the agent to use with requests and mock interceptions are added.</p>
<div class="fragment"><div class="line">import { MockAgent } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21376"></a>
Example - Basic MockAgent instantiation with custom agent</h2>
<div class="fragment"><div class="line">import { Agent, MockAgent } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const agent = new Agent()</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent({ agent })</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21377"></a>
Instance Methods</h1>
<h2><a class="anchor" id="autotoc_md21378"></a>
<code>MockAgent.get(origin)</code></h2>
<p>This method creates and retrieves MockPool or MockClient instances which can then be used to intercept HTTP requests. If the number of connections on the mock agent is set to 1, a MockClient instance is returned. Otherwise a MockPool instance is returned.</p>
<p>For subsequent <code>MockAgent.get</code> calls on the same origin, the same mock instance will be returned.</p>
<p>Arguments:</p>
<ul>
<li><b>origin</b> <code>string | RegExp | (value) =&gt; boolean</code> - a matcher for the pool origin to be retrieved from the MockAgent.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Matcher type   </th><th class="markdownTableHeadNone">Condition to pass    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>string</code>   </td><td class="markdownTableBodyNone">Exact match against string    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>RegExp</code>   </td><td class="markdownTableBodyNone">Regex must pass    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>Function</code>   </td><td class="markdownTableBodyNone">Function must return true   </td></tr>
</table>
<p>Returns: <code>MockClient | MockPool</code>.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>MockAgentOptions</code>   </th><th class="markdownTableHeadNone">Mock instance returned    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>connections === 1</code>   </td><td class="markdownTableBodyNone"><code>MockClient</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>connections</code> &gt; <code>1</code>   </td><td class="markdownTableBodyNone"><code>MockPool</code>   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md21379"></a>
Example - Basic Mocked Request</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const { statusCode, body } = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21380"></a>
Example - Basic Mocked Request with local mock agent dispatcher</h3>
<div class="fragment"><div class="line">import { MockAgent, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;, { dispatcher: mockAgent })</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21381"></a>
Example - Basic Mocked Request with local mock pool dispatcher</h3>
<div class="fragment"><div class="line">import { MockAgent, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;, { dispatcher: mockPool })</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21382"></a>
Example - Basic Mocked Request with local mock client dispatcher</h3>
<div class="fragment"><div class="line">import { MockAgent, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent({ connections: 1 })</div>
<div class="line"> </div>
<div class="line">const mockClient = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockClient.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;, { dispatcher: mockClient })</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21383"></a>
Example - Basic Mocked requests with multiple intercepts</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/hello&#39;}).reply(200, &#39;hello&#39;)</div>
<div class="line"> </div>
<div class="line">const result1 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, result1.statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of result1.body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const result2 = await request(&#39;http://localhost:3000/hello&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, result2.statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of result2.body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data hello</div>
<div class="line">}</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md21384"></a>
Example - Mock different requests within the same file</h3>
<div class="fragment"><div class="line">const { MockAgent, setGlobalDispatcher } = require(&#39;undici&#39;);</div>
<div class="line">const agent = new MockAgent();</div>
<div class="line">agent.disableNetConnect();</div>
<div class="line">setGlobalDispatcher(agent);</div>
<div class="line">describe(&#39;Test&#39;, () =&gt; {</div>
<div class="line">  it(&#39;200&#39;, async () =&gt; {</div>
<div class="line">    const mockAgent = agent.get(&#39;http://test.com&#39;);</div>
<div class="line">    // your test</div>
<div class="line">  });</div>
<div class="line">  it(&#39;200&#39;, async () =&gt; {</div>
<div class="line">    const mockAgent = agent.get(&#39;http://testing.com&#39;);</div>
<div class="line">    // your test</div>
<div class="line">  });</div>
<div class="line">});</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21385"></a>
Example - Mocked request with query body, headers and trailers</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo?hello=there&amp;see=ya&#39;,</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  body: &#39;form1=data1&amp;form2=data2&#39;</div>
<div class="line">}).reply(200, { foo: &#39;bar&#39; }, {</div>
<div class="line">  headers: { &#39;content-type&#39;: &#39;application/json&#39; },</div>
<div class="line">  trailers: { &#39;Content-MD5&#39;: &#39;test&#39; }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  headers,</div>
<div class="line">  trailers,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo?hello=there&amp;see=ya&#39;, {</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  body: &#39;form1=data1&amp;form2=data2&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line">console.log(&#39;headers&#39;, headers) // { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">console.log(&#39;trailers&#39;, trailers) // { &#39;content-md5&#39;: &#39;test&#39; }</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21386"></a>
Example - Mocked request with origin regex</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(new RegExp(&#39;http://localhost:3000&#39;))</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21387"></a>
Example - Mocked request with origin function</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get((origin) =&gt; origin === &#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21388"></a>
<code>MockAgent.close()</code></h2>
<p>Closes the mock agent and waits for registered mock pools and clients to also close before resolving.</p>
<p>Returns: <code>Promise&lt;void&gt;</code></p>
<h3><a class="anchor" id="autotoc_md21389"></a>
Example - clean up after tests are complete</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">await mockAgent.close()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21390"></a>
<code>MockAgent.dispatch(options, handlers)</code></h2>
<p>Implements <a href="Agent.md#parameter-agentdispatchoptions"><code>Agent.dispatch(options, handlers)</code></a>.</p>
<h2><a class="anchor" id="autotoc_md21391"></a>
<code>MockAgent.request(options[, callback])</code></h2>
<p>See <a href="Dispatcher.md#dispatcherrequestoptions-callback"><code>Dispatcher.request(options [, callback])</code></a>.</p>
<h3><a class="anchor" id="autotoc_md21392"></a>
Example - MockAgent request</h3>
<div class="fragment"><div class="line">import { MockAgent } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await mockAgent.request({</div>
<div class="line">  origin: &#39;http://localhost:3000&#39;,</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21393"></a>
<code>MockAgent.deactivate()</code></h2>
<p>This method disables mocking in MockAgent.</p>
<p>Returns: <code>void</code></p>
<h3><a class="anchor" id="autotoc_md21394"></a>
Example - Deactivate Mocking</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">mockAgent.deactivate()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21395"></a>
<code>MockAgent.activate()</code></h2>
<p>This method enables mocking in a MockAgent instance. When instantiated, a MockAgent is automatically activated. Therefore, this method is only effective after <code>MockAgent.deactivate</code> has been called.</p>
<p>Returns: <code>void</code></p>
<h3><a class="anchor" id="autotoc_md21396"></a>
Example - Activate Mocking</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">mockAgent.deactivate()</div>
<div class="line">// No mocking will occur</div>
<div class="line"> </div>
<div class="line">// Later</div>
<div class="line">mockAgent.activate()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21397"></a>
<code>MockAgent.enableNetConnect([host])</code></h2>
<p>When requests are not matched in a MockAgent intercept, a real HTTP request is attempted. We can control this further through the use of <code>enableNetConnect</code>. This is achieved by defining host matchers so only matching requests will be attempted.</p>
<p>When using a string, it should only include the <b>hostname and optionally, the port</b>. In addition, calling this method multiple times with a string will allow all HTTP requests that match these values.</p>
<p>Arguments:</p>
<ul>
<li><b>host</b> <code>string | RegExp | (value) =&gt; boolean</code> - (optional)</li>
</ul>
<p>Returns: <code>void</code></p>
<h3><a class="anchor" id="autotoc_md21398"></a>
Example - Allow all non-matching urls to be dispatched in a real HTTP request</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">mockAgent.enableNetConnect()</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example.com&#39;)</div>
<div class="line">// A real request is made</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21399"></a>
Example - Allow requests matching a host string to make real requests</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">mockAgent.enableNetConnect(&#39;example-1.com&#39;)</div>
<div class="line">mockAgent.enableNetConnect(&#39;example-2.com:8080&#39;)</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example-1.com&#39;)</div>
<div class="line">// A real request is made</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example-2.com:8080&#39;)</div>
<div class="line">// A real request is made</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example-3.com&#39;)</div>
<div class="line">// Will throw</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21400"></a>
Example - Allow requests matching a host regex to make real requests</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">mockAgent.enableNetConnect(new RegExp(&#39;example.com&#39;))</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example.com&#39;)</div>
<div class="line">// A real request is made</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21401"></a>
Example - Allow requests matching a host function to make real requests</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">mockAgent.enableNetConnect((value) =&gt; value === &#39;example.com&#39;)</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example.com&#39;)</div>
<div class="line">// A real request is made</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21402"></a>
<code>MockAgent.disableNetConnect()</code></h2>
<p>This method causes all requests to throw when requests are not matched in a MockAgent intercept.</p>
<p>Returns: <code>void</code></p>
<h3><a class="anchor" id="autotoc_md21403"></a>
Example - Disable all non-matching requests by throwing an error for each</h3>
<div class="fragment"><div class="line">import { MockAgent, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line"> </div>
<div class="line">mockAgent.disableNetConnect()</div>
<div class="line"> </div>
<div class="line">await request(&#39;http://example.com&#39;)</div>
<div class="line">// Will throw</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21404"></a>
<code>MockAgent.pendingInterceptors()</code></h2>
<p>This method returns any pending interceptors registered on a mock agent. A pending interceptor meets one of the following criteria:</p>
<ul>
<li>Is registered with neither <code>.times(&lt;number&gt;)</code> nor <code>.persist()</code>, and has not been invoked;</li>
<li>Is persistent (i.e., registered with <code>.persist()</code>) and has not been invoked;</li>
<li>Is registered with <code>.times(&lt;number&gt;)</code> and has not been invoked <code>&lt;number&gt;</code> of times.</li>
</ul>
<p>Returns: <code>PendingInterceptor[]</code> (where <code>PendingInterceptor</code> is a <code>MockDispatch</code> with an additional <code>origin: string</code>)</p>
<h3><a class="anchor" id="autotoc_md21405"></a>
Example - List all pending inteceptors</h3>
<div class="fragment"><div class="line">const agent = new MockAgent()</div>
<div class="line">agent.disableNetConnect()</div>
<div class="line"> </div>
<div class="line">agent</div>
<div class="line">  .get(&#39;https://example.com&#39;)</div>
<div class="line">  .intercept({ method: &#39;GET&#39;, path: &#39;/&#39; })</div>
<div class="line">  .reply(200)</div>
<div class="line"> </div>
<div class="line">const pendingInterceptors = agent.pendingInterceptors()</div>
<div class="line">// Returns [</div>
<div class="line">//   {</div>
<div class="line">//     timesInvoked: 0,</div>
<div class="line">//     times: 1,</div>
<div class="line">//     persist: false,</div>
<div class="line">//     consumed: false,</div>
<div class="line">//     pending: true,</div>
<div class="line">//     path: &#39;/&#39;,</div>
<div class="line">//     method: &#39;GET&#39;,</div>
<div class="line">//     body: undefined,</div>
<div class="line">//     headers: undefined,</div>
<div class="line">//     data: {</div>
<div class="line">//       error: null,</div>
<div class="line">//       statusCode: 200,</div>
<div class="line">//       data: &#39;&#39;,</div>
<div class="line">//       headers: {},</div>
<div class="line">//       trailers: {}</div>
<div class="line">//     },</div>
<div class="line">//     origin: &#39;https://example.com&#39;</div>
<div class="line">//   }</div>
<div class="line">// ]</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21406"></a>
<code>MockAgent.assertNoPendingInterceptors([options])</code></h2>
<p>This method throws if the mock agent has any pending interceptors. A pending interceptor meets one of the following criteria:</p>
<ul>
<li>Is registered with neither <code>.times(&lt;number&gt;)</code> nor <code>.persist()</code>, and has not been invoked;</li>
<li>Is persistent (i.e., registered with <code>.persist()</code>) and has not been invoked;</li>
<li>Is registered with <code>.times(&lt;number&gt;)</code> and has not been invoked <code>&lt;number&gt;</code> of times.</li>
</ul>
<h3><a class="anchor" id="autotoc_md21407"></a>
Example - Check that there are no pending interceptors</h3>
<div class="fragment"><div class="line">const agent = new MockAgent()</div>
<div class="line">agent.disableNetConnect()</div>
<div class="line"> </div>
<div class="line">agent</div>
<div class="line">  .get(&#39;https://example.com&#39;)</div>
<div class="line">  .intercept({ method: &#39;GET&#39;, path: &#39;/&#39; })</div>
<div class="line">  .reply(200)</div>
<div class="line"> </div>
<div class="line">agent.assertNoPendingInterceptors()</div>
<div class="line">// Throws an UndiciError with the following message:</div>
<div class="line">//</div>
<div class="line">// 1 interceptor is pending:</div>
<div class="line">//</div>
<div class="line">// ┌─────────┬────────┬───────────────────────┬──────┬─────────────┬────────────┬─────────────┬───────────┐</div>
<div class="line">// │ (index) │ Method │        Origin         │ Path │ Status code │ Persistent │ Invocations │ Remaining │</div>
<div class="line">// ├─────────┼────────┼───────────────────────┼──────┼─────────────┼────────────┼─────────────┼───────────┤</div>
<div class="line">// │    0    │ &#39;GET&#39;  │ &#39;https://example.com&#39; │ &#39;/&#39;  │     200     │    &#39;❌&#39;    │      0      │     1     │</div>
<div class="line">// └─────────┴────────┴───────────────────────┴──────┴─────────────┴────────────┴─────────────┴───────────┘</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
