<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FoodLink: Client Lifecycle</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FoodLink
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__d_1_2_g_i_t_2_food_link_2foodlink_8client_2node__modules_2undici_2docs_2api_2api-lifecycle.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Client Lifecycle</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md21224"></a></p>
<p>An Undici <a class="el" href="md__d_1_2_g_i_t_2_food_link_2foodlink_8client_2node__modules_2undici_2docs_2api_2_client.html">Client</a> can be best described as a state machine. The following list is a summary of the various state transitions the <code>Client</code> will go through in its lifecycle. This document also contains detailed breakdowns of each state.</p>
<blockquote class="doxtable">
<p>This diagram is not a perfect representation of the undici Client. Since the Client class is not actually implemented as a state-machine, actual execution may deviate slightly from what is described below. Consider this as a general resource for understanding the inner workings of the Undici client rather than some kind of formal specification. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md21225"></a>
State Transition Overview</h1>
<ul>
<li>A <code>Client</code> begins in the <b>idle</b> state with no socket connection and no requests in queue.<ul>
<li>The <em>connect</em> event transitions the <code>Client</code> to the <b>pending</b> state where requests can be queued prior to processing.</li>
<li>The <em>close</em> and <em>destroy</em> events transition the <code>Client</code> to the <b>destroyed</b> state. Since there are no requests in the queue, the <em>close</em> event immediately transitions to the <b>destroyed</b> state.</li>
</ul>
</li>
<li>The <b>pending</b> state indicates the underlying socket connection has been successfully established and requests are queueing.<ul>
<li>The <em>process</em> event transitions the <code>Client</code> to the <b>processing</b> state where requests are processed.</li>
<li>If requests are queued, the <em>close</em> event transitions to the <b>processing</b> state; otherwise, it transitions to the <b>destroyed</b> state.</li>
<li>The <em>destroy</em> event transitions to the <b>destroyed</b> state.</li>
</ul>
</li>
<li>The <b>processing</b> state initializes to the <b>processing.running</b> state.<ul>
<li>If the current request requires draining, the <em>needDrain</em> event transitions the <code>Client</code> into the <b>processing.busy</b> state which will return to the <b>processing.running</b> state with the <em>drainComplete</em> event.</li>
<li>After all queued requests are completed, the <em>keepalive</em> event transitions the <code>Client</code> back to the <b>pending</b> state. If no requests are queued during the timeout, the <b>close</b> event transitions the <code>Client</code> to the <b>destroyed</b> state.</li>
<li>If the <em>close</em> event is fired while the <code>Client</code> still has queued requests, the <code>Client</code> transitions to the <b>process.closing</b> state where it will complete all existing requests before firing the <em>done</em> event.</li>
<li>The <em>done</em> event gracefully transitions the <code>Client</code> to the <b>destroyed</b> state.</li>
<li>At any point in time, the <em>destroy</em> event will transition the <code>Client</code> from the <b>processing</b> state to the <b>destroyed</b> state, destroying any queued requests.</li>
</ul>
</li>
<li>The <b>destroyed</b> state is a final state and the <code>Client</code> is no longer functional.</li>
</ul>
<p><img src="../assets/lifecycle-diagram.png" alt="A state diagram representing an Undici Client instance" class="inline"/></p>
<blockquote class="doxtable">
<p>The diagram was generated using Mermaid.js Live Editor. Modify the state diagram <a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoic3RhdGVEaWFncmFtLXYyXG4gICAgWypdIC0tPiBpZGxlXG4gICAgaWRsZSAtLT4gcGVuZGluZyA6IGNvbm5lY3RcbiAgICBpZGxlIC0tPiBkZXN0cm95ZWQgOiBkZXN0cm95L2Nsb3NlXG4gICAgXG4gICAgcGVuZGluZyAtLT4gaWRsZSA6IHRpbWVvdXRcbiAgICBwZW5kaW5nIC0tPiBkZXN0cm95ZWQgOiBkZXN0cm95XG5cbiAgICBzdGF0ZSBjbG9zZV9mb3JrIDw8Zm9yaz4-XG4gICAgcGVuZGluZyAtLT4gY2xvc2VfZm9yayA6IGNsb3NlXG4gICAgY2xvc2VfZm9yayAtLT4gcHJvY2Vzc2luZ1xuICAgIGNsb3NlX2ZvcmsgLS0-IGRlc3Ryb3llZFxuXG4gICAgcGVuZGluZyAtLT4gcHJvY2Vzc2luZyA6IHByb2Nlc3NcblxuICAgIHByb2Nlc3NpbmcgLS0-IHBlbmRpbmcgOiBrZWVwYWxpdmVcbiAgICBwcm9jZXNzaW5nIC0tPiBkZXN0cm95ZWQgOiBkb25lXG4gICAgcHJvY2Vzc2luZyAtLT4gZGVzdHJveWVkIDogZGVzdHJveVxuXG4gICAgc3RhdGUgcHJvY2Vzc2luZyB7XG4gICAgICAgIHJ1bm5pbmcgLS0-IGJ1c3kgOiBuZWVkRHJhaW5cbiAgICAgICAgYnVzeSAtLT4gcnVubmluZyA6IGRyYWluQ29tcGxldGVcbiAgICAgICAgcnVubmluZyAtLT4gWypdIDoga2VlcGFsaXZlXG4gICAgICAgIHJ1bm5pbmcgLS0-IGNsb3NpbmcgOiBjbG9zZVxuICAgICAgICBjbG9zaW5nIC0tPiBbKl0gOiBkb25lXG4gICAgICAgIFsqXSAtLT4gcnVubmluZ1xuICAgIH1cbiAgICAiLCJtZXJtYWlkIjp7InRoZW1lIjoiYmFzZSJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ">here</a> </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md21226"></a>
State details</h1>
<h2><a class="anchor" id="autotoc_md21227"></a>
idle</h2>
<p>The <b>idle</b> state is the initial state of a <code>Client</code> instance. While an <code>origin</code> is required for instantiating a <code>Client</code> instance, the underlying socket connection will not be established until a request is queued using <a href="Client.md#clientdispatchoptions-handlers"><code>Client.dispatch()</code></a>. By calling <code>Client.dispatch()</code> directly or using one of the multiple implementations (<a href="Client.md#clientconnectoptions-callback"><code>Client.connect()</code></a>, <a href="Client.md#clientpipelineoptions-handler"><code>Client.pipeline()</code></a>, <a href="Client.md#clientrequestoptions-callback"><code>Client.request()</code></a>, <a href="Client.md#clientstreamoptions-factory-callback"><code>Client.stream()</code></a>, and <a href="Client.md#clientupgradeoptions-callback"><code>Client.upgrade()</code></a>), the <code>Client</code> instance will transition from <b>idle</b> to **pending** and then most likely directly to **processing**.</p>
<p>Calling <a href="Client.md#clientclosecallback"><code>Client.close()</code></a> or <a href="Client.md#clientdestroyerror-callback"><code>Client.destroy()</code></a> transitions directly to the **destroyed** state since the <code>Client</code> instance will have no queued requests in this state.</p>
<h2><a class="anchor" id="autotoc_md21228"></a>
pending</h2>
<p>The <b>pending</b> state signifies a non-processing <code>Client</code>. Upon entering this state, the <code>Client</code> establishes a socket connection and emits the <a href="Client.md#event-connect">&lsquo;'connect&rsquo;`</a> event signalling a connection was successfully established with the <code>origin</code> provided during <code>Client</code> instantiation. The internal queue is initially empty, and requests can start queueing.</p>
<p>Calling <a href="Client.md#clientclosecallback"><code>Client.close()</code></a> with queued requests, transitions the <code>Client</code> to the **processing** state. Without queued requests, it transitions to the **destroyed** state.</p>
<p>Calling <a href="Client.md#clientdestroyerror-callback"><code>Client.destroy()</code></a> transitions directly to the **destroyed** state regardless of existing requests.</p>
<h2><a class="anchor" id="autotoc_md21229"></a>
processing</h2>
<p>The <b>processing</b> state is a state machine within itself. It initializes to the **processing.running** state. The <a href="Client.md#clientdispatchoptions-handlers"><code>Client.dispatch()</code></a>, <a href="Client.md#clientclosecallback"><code>Client.close()</code></a>, and <a href="Client.md#clientdestroyerror-callback"><code>Client.destroy()</code></a> can be called at any time while the <code>Client</code> is in this state. <code>Client.dispatch()</code> will add more requests to the queue while existing requests continue to be processed. <code>Client.close()</code> will transition to the **processing.closing** state. And <code>Client.destroy()</code> will transition to **destroyed**.</p>
<h3><a class="anchor" id="autotoc_md21230"></a>
running</h3>
<p>In the <b>processing.running</b> sub-state, queued requests are being processed in a FIFO order. If a request body requires draining, the <em>needDrain</em> event transitions to the **processing.busy** sub-state. The <em>close</em> event transitions the Client to the **process.closing** sub-state. If all queued requests are processed and neither <a href="Client.md#clientclosecallback"><code>Client.close()</code></a> nor <a href="Client.md#clientdestroyerror-callback"><code>Client.destroy()</code></a> are called, then the **processing** machine will trigger a <em>keepalive</em> event transitioning the <code>Client</code> back to the **pending** state. During this time, the <code>Client</code> is waiting for the socket connection to timeout, and once it does, it triggers the <em>timeout</em> event and transitions to the <a class="el" href="D:/GIT/FoodLink/foodlink.client/node_modules/fastq/README.md#idle">**idle**</a> state.</p>
<h3><a class="anchor" id="autotoc_md21231"></a>
busy</h3>
<p>This sub-state is only entered when a request body is an instance of <a href="https://nodejs.org/api/stream.html">Stream</a> and requires draining. The <code>Client</code> cannot process additional requests while in this state and must wait until the currently processing request body is completely drained before transitioning back to **processing.running**.</p>
<h3><a class="anchor" id="autotoc_md21232"></a>
closing</h3>
<p>This sub-state is only entered when a <code>Client</code> instance has queued requests and the <a href="Client.md#clientclosecallback"><code>Client.close()</code></a> method is called. In this state, the <code>Client</code> instance continues to process requests as usual, with the one exception that no additional requests can be queued. Once all of the queued requests are processed, the <code>Client</code> will trigger the <em>done</em> event gracefully entering the **destroyed** state without an error.</p>
<h2><a class="anchor" id="autotoc_md21233"></a>
destroyed</h2>
<p>The <b>destroyed</b> state is a final state for the <code>Client</code> instance. Once in this state, a <code>Client</code> is nonfunctional. Calling any other <code>Client</code> methods will result in an <code>ClientDestroyedError</code>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
