<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FoodLink: Class: MockPool</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">FoodLink
   </div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__d_1_2_g_i_t_2_food_link_2foodlink_8client_2node__modules_2undici_2docs_2api_2_mock_pool.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Class: MockPool</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md21419"></a></p>
<p>Extends: <code>undici.Pool</code></p>
<p>A mock Pool class that implements the Pool API and is used by MockAgent to intercept real requests and return mocked responses.</p>
<h1><a class="anchor" id="autotoc_md21420"></a>
<code>new MockPool(origin, [options])</code></h1>
<p>Arguments:</p>
<ul>
<li><b>origin</b> <code>string</code> - It should only include the <b>protocol, hostname, and port</b>.</li>
<li><b>options</b> <code>MockPoolOptions</code> - It extends the <code>Pool</code> options.</li>
</ul>
<p>Returns: <code>MockPool</code></p>
<h2><a class="anchor" id="autotoc_md21421"></a>
Parameter: <code>MockPoolOptions</code></h2>
<p>Extends: <code>PoolOptions</code></p>
<ul>
<li><b>agent</b> <code>Agent</code> - the agent to associate this MockPool with.</li>
</ul>
<h2><a class="anchor" id="autotoc_md21422"></a>
Example - Basic MockPool instantiation</h2>
<p>We can use MockAgent to instantiate a MockPool ready to be used to intercept specified requests. It will not do anything until registered as the agent to use and any mock request are registered.</p>
<div class="fragment"><div class="line">import { MockAgent } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21423"></a>
Instance Methods</h1>
<h2><a class="anchor" id="autotoc_md21424"></a>
<code>MockPool.intercept(options)</code></h2>
<p>This method defines the interception rules for matching against requests for a MockPool or MockPool. We can intercept multiple times on a single instance, but each intercept is only used once. For example if you expect to make 2 requests inside a test, you need to call <code>intercept()</code> twice. Assuming you use <code>disableNetConnect()</code> you will get <code>MockNotMatchedError</code> on the second request when you only call <code>intercept()</code> once.</p>
<p>When defining interception rules, all the rules must pass for a request to be intercepted. If a request is not intercepted, a real request will be attempted.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Matcher type   </th><th class="markdownTableHeadNone">Condition to pass    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>string</code>   </td><td class="markdownTableBodyNone">Exact match against string    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter"><code>RegExp</code>   </td><td class="markdownTableBodyNone">Regex must pass    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><code>Function</code>   </td><td class="markdownTableBodyNone">Function must return true   </td></tr>
</table>
<p>Arguments:</p>
<ul>
<li><b>options</b> <code>MockPoolInterceptOptions</code> - Interception options.</li>
</ul>
<p>Returns: <code>MockInterceptor</code> corresponding to the input options.</p>
<h2><a class="anchor" id="autotoc_md21425"></a>
Parameter: <code>MockPoolInterceptOptions</code></h2>
<ul>
<li><b>path</b> <code>string | RegExp | (path: string) =&gt; boolean</code> - a matcher for the HTTP request path.</li>
<li><b>method</b> <code>string | RegExp | (method: string) =&gt; boolean</code> - (optional) - a matcher for the HTTP request method. Defaults to <code>GET</code>.</li>
<li><b>body</b> <code>string | RegExp | (body: string) =&gt; boolean</code> - (optional) - a matcher for the HTTP request body.</li>
<li><b>headers</b> <code>Record&lt;string, string | RegExp | (body: string) =&gt; boolean</code>&gt; - (optional) - a matcher for the HTTP request headers. To be intercepted, a request must match all defined headers. Extra headers not defined here may (or may not) be included in the request and do not affect the interception in any way.</li>
<li><b>query</b> <code>Record&lt;string, any&gt; | null</code> - (optional) - a matcher for the HTTP request query string params.</li>
</ul>
<h2><a class="anchor" id="autotoc_md21426"></a>
Return: <code>MockInterceptor</code></h2>
<p>We can define the behaviour of an intercepted request with the following options.</p>
<ul>
<li><b>reply</b> <code>(statusCode: number, replyData: string | Buffer | object | MockInterceptor.MockResponseDataHandler, responseOptions?: MockResponseOptions) =&gt; MockScope</code> - define a reply for a matching request. You can define the replyData as a callback to read incoming request data. Default for <code>responseOptions</code> is <code>{}</code>.</li>
<li><b>reply</b> <code>(callback: MockInterceptor.MockReplyOptionsCallback) =&gt; MockScope</code> - define a reply for a matching request, allowing dynamic mocking of all reply options rather than just the data.</li>
<li><b>replyWithError</b> <code>(error: Error) =&gt; MockScope</code> - define an error for a matching request to throw.</li>
<li><b>defaultReplyHeaders</b> <code>(headers: Record&lt;string, string&gt;) =&gt; MockInterceptor</code> - define default headers to be included in subsequent replies. These are in addition to headers on a specific reply.</li>
<li><b>defaultReplyTrailers</b> <code>(trailers: Record&lt;string, string&gt;) =&gt; MockInterceptor</code> - define default trailers to be included in subsequent replies. These are in addition to trailers on a specific reply.</li>
<li><b>replyContentLength</b> <code>() =&gt; MockInterceptor</code> - define automatically calculated <code>content-length</code> headers to be included in subsequent replies.</li>
</ul>
<p>The reply data of an intercepted request may either be a string, buffer, or JavaScript object. Objects are converted to JSON while strings and buffers are sent as-is.</p>
<p>By default, <code>reply</code> and <code>replyWithError</code> define the behaviour for the first matching request only. Subsequent requests will not be affected (this can be changed using the returned <code>MockScope</code>).</p>
<h2><a class="anchor" id="autotoc_md21427"></a>
Parameter: <code>MockResponseOptions</code></h2>
<ul>
<li><b>headers</b> <code>Record&lt;string, string&gt;</code> - headers to be included on the mocked reply.</li>
<li><b>trailers</b> <code>Record&lt;string, string&gt;</code> - trailers to be included on the mocked reply.</li>
</ul>
<h2><a class="anchor" id="autotoc_md21428"></a>
Return: <code>MockScope</code></h2>
<p>A <code>MockScope</code> is associated with a single <code>MockInterceptor</code>. With this, we can configure the default behaviour of a intercepted reply.</p>
<ul>
<li><b>delay</b> <code>(waitInMs: number) =&gt; MockScope</code> - delay the associated reply by a set amount in ms.</li>
<li><b>persist</b> <code>() =&gt; MockScope</code> - any matching request will always reply with the defined response indefinitely.</li>
<li><b>times</b> <code>(repeatTimes: number) =&gt; MockScope</code> - any matching request will reply with the defined response a fixed amount of times. This is overridden by <b>persist</b>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md21429"></a>
Example - Basic Mocked Request</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">// MockPool</div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({ path: &#39;/foo&#39; }).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21430"></a>
Example - Mocked request using reply data callbacks</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/echo&#39;,</div>
<div class="line">  method: &#39;GET&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    &#39;User-Agent&#39;: &#39;undici&#39;,</div>
<div class="line">    Host: &#39;example.com&#39;</div>
<div class="line">  }</div>
<div class="line">}).reply(200, ({ headers }) =&gt; ({ message: headers.get(&#39;message&#39;) }))</div>
<div class="line"> </div>
<div class="line">const { statusCode, body, headers } = await request(&#39;http://localhost:3000&#39;, {</div>
<div class="line">  headers: {</div>
<div class="line">    message: &#39;hello world!&#39;</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line">console.log(&#39;headers&#39;, headers) // { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // { &quot;message&quot;:&quot;hello world!&quot; }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21431"></a>
Example - Mocked request using reply options callback</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/echo&#39;,</div>
<div class="line">  method: &#39;GET&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    &#39;User-Agent&#39;: &#39;undici&#39;,</div>
<div class="line">    Host: &#39;example.com&#39;</div>
<div class="line">  }</div>
<div class="line">}).reply(({ headers }) =&gt; ({ statusCode: 200, data: { message: headers.get(&#39;message&#39;) }})))</div>
<div class="line"> </div>
<div class="line">const { statusCode, body, headers } = await request(&#39;http://localhost:3000&#39;, {</div>
<div class="line">  headers: {</div>
<div class="line">    message: &#39;hello world!&#39;</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line">console.log(&#39;headers&#39;, headers) // { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // { &quot;message&quot;:&quot;hello world!&quot; }</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21432"></a>
Example - Basic Mocked requests with multiple intercepts</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/hello&#39;,</div>
<div class="line">  method: &#39;GET&#39;,</div>
<div class="line">}).reply(200, &#39;hello&#39;)</div>
<div class="line"> </div>
<div class="line">const result1 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, result1.statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of result1.body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">const result2 = await request(&#39;http://localhost:3000/hello&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, result2.statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of result2.body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data hello</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21433"></a>
Example - Mocked request with query body, request headers and response headers and trailers</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo?hello=there&amp;see=ya&#39;,</div>
<div class="line">  method: &#39;POST&#39;,</div>
<div class="line">  body: &#39;form1=data1&amp;form2=data2&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    &#39;User-Agent&#39;: &#39;undici&#39;,</div>
<div class="line">    Host: &#39;example.com&#39;</div>
<div class="line">  }</div>
<div class="line">}).reply(200, { foo: &#39;bar&#39; }, {</div>
<div class="line">  headers: { &#39;content-type&#39;: &#39;application/json&#39; },</div>
<div class="line">  trailers: { &#39;Content-MD5&#39;: &#39;test&#39; }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  headers,</div>
<div class="line">  trailers,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo?hello=there&amp;see=ya&#39;, {</div>
<div class="line">    method: &#39;POST&#39;,</div>
<div class="line">    body: &#39;form1=data1&amp;form2=data2&#39;,</div>
<div class="line">    headers: {</div>
<div class="line">      foo: &#39;bar&#39;,</div>
<div class="line">      &#39;User-Agent&#39;: &#39;undici&#39;,</div>
<div class="line">      Host: &#39;example.com&#39;</div>
<div class="line">    }</div>
<div class="line">  })</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line">console.log(&#39;headers&#39;, headers) // { &#39;content-type&#39;: &#39;application/json&#39; }</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // &#39;{&quot;foo&quot;:&quot;bar&quot;}&#39;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">console.log(&#39;trailers&#39;, trailers) // { &#39;content-md5&#39;: &#39;test&#39; }</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21434"></a>
Example - Mocked request using different matchers</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: /^GET$/,</div>
<div class="line">  body: (value) =&gt; value === &#39;form=data&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    &#39;User-Agent&#39;: &#39;undici&#39;,</div>
<div class="line">    Host: /^example.com$/</div>
<div class="line">  }</div>
<div class="line">}).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await request(&#39;http://localhost:3000/foo&#39;, {</div>
<div class="line">  method: &#39;GET&#39;,</div>
<div class="line">  body: &#39;form=data&#39;,</div>
<div class="line">  headers: {</div>
<div class="line">    foo: &#39;bar&#39;,</div>
<div class="line">    &#39;User-Agent&#39;: &#39;undici&#39;,</div>
<div class="line">    Host: &#39;example.com&#39;</div>
<div class="line">  }</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21435"></a>
Example - Mocked request with reply with a defined error</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).replyWithError(new Error(&#39;kaboom&#39;))</div>
<div class="line"> </div>
<div class="line">try {</div>
<div class="line">  await request(&#39;http://localhost:3000/foo&#39;, {</div>
<div class="line">    method: &#39;GET&#39;</div>
<div class="line">  })</div>
<div class="line">} catch (error) {</div>
<div class="line">  console.error(error) // Error: kaboom</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21436"></a>
Example - Mocked request with defaultReplyHeaders</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).defaultReplyHeaders({ foo: &#39;bar&#39; })</div>
<div class="line">  .reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const { headers } = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;headers&#39;, headers) // headers { foo: &#39;bar&#39; }</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21437"></a>
Example - Mocked request with defaultReplyTrailers</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).defaultReplyTrailers({ foo: &#39;bar&#39; })</div>
<div class="line">  .reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const { trailers } = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;trailers&#39;, trailers) // trailers { foo: &#39;bar&#39; }</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21438"></a>
Example - Mocked request with automatic content-length calculation</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).replyContentLength().reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const { headers } = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;headers&#39;, headers) // headers { &#39;content-length&#39;: &#39;3&#39; }</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21439"></a>
Example - Mocked request with automatic content-length calculation on an object</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).replyContentLength().reply(200, { foo: &#39;bar&#39; })</div>
<div class="line"> </div>
<div class="line">const { headers } = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line"> </div>
<div class="line">console.log(&#39;headers&#39;, headers) // headers { &#39;content-length&#39;: &#39;13&#39; }</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21440"></a>
Example - Mocked request with persist enabled</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).reply(200, &#39;foo&#39;).persist()</div>
<div class="line"> </div>
<div class="line">const result1 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line">// Will match and return mocked data</div>
<div class="line"> </div>
<div class="line">const result2 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line">// Will match and return mocked data</div>
<div class="line"> </div>
<div class="line">// Etc</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21441"></a>
Example - Mocked request with times enabled</h3>
<div class="fragment"><div class="line">import { MockAgent, setGlobalDispatcher, request } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">setGlobalDispatcher(mockAgent)</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">}).reply(200, &#39;foo&#39;).times(2)</div>
<div class="line"> </div>
<div class="line">const result1 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line">// Will match and return mocked data</div>
<div class="line"> </div>
<div class="line">const result2 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line">// Will match and return mocked data</div>
<div class="line"> </div>
<div class="line">const result3 = await request(&#39;http://localhost:3000/foo&#39;)</div>
<div class="line">// Will not match and make attempt a real request</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21442"></a>
<code>MockPool.close()</code></h2>
<p>Closes the mock pool and de-registers from associated MockAgent.</p>
<p>Returns: <code>Promise&lt;void&gt;</code></p>
<h3><a class="anchor" id="autotoc_md21443"></a>
Example - clean up after tests are complete</h3>
<div class="fragment"><div class="line">import { MockAgent } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line"> </div>
<div class="line">await mockPool.close()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21444"></a>
<code>MockPool.dispatch(options, handlers)</code></h2>
<p>Implements <a href="Dispatcher.md#dispatcherdispatchoptions-handler"><code>Dispatcher.dispatch(options, handlers)</code></a>.</p>
<h2><a class="anchor" id="autotoc_md21445"></a>
<code>MockPool.request(options[, callback])</code></h2>
<p>See <a href="Dispatcher.md#dispatcherrequestoptions-callback"><code>Dispatcher.request(options [, callback])</code></a>.</p>
<h3><a class="anchor" id="autotoc_md21446"></a>
Example - MockPool request</h3>
<div class="fragment"><div class="line">import { MockAgent } from &#39;undici&#39;</div>
<div class="line"> </div>
<div class="line">const mockAgent = new MockAgent()</div>
<div class="line"> </div>
<div class="line">const mockPool = mockAgent.get(&#39;http://localhost:3000&#39;)</div>
<div class="line">mockPool.intercept({</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;,</div>
<div class="line">}).reply(200, &#39;foo&#39;)</div>
<div class="line"> </div>
<div class="line">const {</div>
<div class="line">  statusCode,</div>
<div class="line">  body</div>
<div class="line">} = await mockPool.request({</div>
<div class="line">  origin: &#39;http://localhost:3000&#39;,</div>
<div class="line">  path: &#39;/foo&#39;,</div>
<div class="line">  method: &#39;GET&#39;</div>
<div class="line">})</div>
<div class="line"> </div>
<div class="line">console.log(&#39;response received&#39;, statusCode) // response received 200</div>
<div class="line"> </div>
<div class="line">for await (const data of body) {</div>
<div class="line">  console.log(&#39;data&#39;, data.toString(&#39;utf8&#39;)) // data foo</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
