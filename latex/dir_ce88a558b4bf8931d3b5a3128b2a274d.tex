\doxysection{D\+:/\+GIT/\+Food\+Link/foodlink.client/node\+\_\+modules/@npmcli/run-\/script Directory Reference}
\hypertarget{dir_ce88a558b4bf8931d3b5a3128b2a274d}{}\label{dir_ce88a558b4bf8931d3b5a3128b2a274d}\index{D:/GIT/FoodLink/foodlink.client/node\_modules/"@npmcli/run-\/script Directory Reference@{D:/GIT/FoodLink/foodlink.client/node\_modules/"@npmcli/run-\/script Directory Reference}}


\doxysubsection{Detailed Description}
Run a lifecycle script for a package (descendant of npm-\/lifecycle)\hypertarget{README.md_autotoc_md1638}{}\doxysubsection{\texorpdfstring{USAGE}{USAGE}}\label{README.md_autotoc_md1638}

\begin{DoxyCode}{0}
\DoxyCodeLine{const\ runScript\ =\ require('@npmcli/run-\/script')}
\DoxyCodeLine{}
\DoxyCodeLine{runScript(\{}
\DoxyCodeLine{\ \ //\ required,\ the\ script\ to\ run}
\DoxyCodeLine{\ \ event:\ 'install',}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ extra\ args\ to\ pass\ to\ the\ command,\ defaults\ to\ []}
\DoxyCodeLine{\ \ args:\ [],}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ required,\ the\ folder\ where\ the\ package\ lives}
\DoxyCodeLine{\ \ path:\ '/path/to/package/folder',}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ optional,\ these\ paths\ will\ be\ put\ at\ the\ beginning\ of\ \`{}\$PATH`,\ even}
\DoxyCodeLine{\ \ //\ after\ run-\/script\ adds\ the\ node\_modules/.bin\ folder(s)\ from}
\DoxyCodeLine{\ \ //\ \`{}process.cwd()`.\ This\ is\ for\ commands\ like\ \`{}npm\ init`,\ \`{}npm\ exec`,}
\DoxyCodeLine{\ \ //\ and\ \`{}npx`\ to\ make\ sure\ manually\ installed\ \ packages\ come\ before}
\DoxyCodeLine{\ \ //\ anything\ that\ happens\ to\ be\ in\ the\ tree\ in\ \`{}process.cwd()`.}
\DoxyCodeLine{\ \ binPaths:\ [}
\DoxyCodeLine{\ \ \ \ '/path/to/npx/node\_modules/.bin',}
\DoxyCodeLine{\ \ \ \ '/path/to/npm/prefix/node\_modules/.bin',}
\DoxyCodeLine{\ \ ],}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ optional,\ defaults\ to\ /bin/sh\ on\ unix,\ or\ cmd.exe\ on\ windows}
\DoxyCodeLine{\ \ scriptShell:\ '/bin/bash',}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ optional,\ passed\ directly\ to\ \`{}@npmcli/promise-\/spawn`\ which\ defaults\ it\ to\ true}
\DoxyCodeLine{\ \ //\ return\ stdout\ and\ stderr\ as\ strings\ rather\ than\ buffers}
\DoxyCodeLine{\ \ stdioString:\ false,}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ optional,\ additional\ environment\ variables\ to\ add}
\DoxyCodeLine{\ \ //\ note\ that\ process.env\ IS\ inherited\ by\ default}
\DoxyCodeLine{\ \ //\ Always\ set:}
\DoxyCodeLine{\ \ //\ -\/\ npm\_package\_json\ The\ package.json\ file\ in\ the\ folder}
\DoxyCodeLine{\ \ //\ -\/\ npm\_lifecycle\_event\ The\ event\ that\ this\ is\ being\ run\ for}
\DoxyCodeLine{\ \ //\ -\/\ npm\_lifecycle\_script\ The\ script\ being\ run}
\DoxyCodeLine{\ \ //\ The\ fields\ described\ in\ https://github.com/npm/rfcs/pull/183}
\DoxyCodeLine{\ \ env:\ \{}
\DoxyCodeLine{\ \ \ \ npm\_package\_from:\ 'foo@bar',}
\DoxyCodeLine{\ \ \ \ npm\_package\_resolved:\ 'https://registry.npmjs.org/foo/-\//foo-\/1.2.3.tgz',}
\DoxyCodeLine{\ \ \ \ npm\_package\_integrity:\ 'sha512-\/foobarbaz',}
\DoxyCodeLine{\ \ \},}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ defaults\ to\ 'pipe'.\ \ Can\ also\ pass\ an\ array\ like\ you\ would\ to\ node's}
\DoxyCodeLine{\ \ //\ exec\ or\ spawn\ functions.\ \ Note\ that\ if\ it's\ anything\ other\ than}
\DoxyCodeLine{\ \ //\ 'pipe'\ then\ the\ stdout/stderr\ values\ on\ the\ result\ will\ be\ missing.}
\DoxyCodeLine{\ \ //\ npm\ cli\ sets\ this\ to\ 'inherit'\ for\ explicit\ run-\/scripts\ (test,\ etc.)}
\DoxyCodeLine{\ \ //\ but\ leaves\ it\ as\ 'pipe'\ for\ install\ scripts\ that\ run\ in\ parallel.}
\DoxyCodeLine{\ \ stdio:\ 'inherit',}
\DoxyCodeLine{}
\DoxyCodeLine{\ \ //\ print\ the\ package\ id\ and\ script,\ and\ the\ command\ to\ be\ run,\ like:}
\DoxyCodeLine{\ \ //\ >\ somepackage@1.2.3\ postinstall}
\DoxyCodeLine{\ \ //\ >\ make\ all-\/the-\/things}
\DoxyCodeLine{\ \ //\ Defaults\ true\ when\ stdio:'inherit',\ otherwise\ suppressed}
\DoxyCodeLine{\ \ banner:\ true,}
\DoxyCodeLine{\})}
\DoxyCodeLine{\ \ .then((\{\ code,\ signal,\ stdout,\ stderr,\ pkgid,\ path,\ event,\ script\ \})\ =>\ \{}
\DoxyCodeLine{\ \ \ \ //\ do\ something\ with\ the\ results}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .catch(er\ =>\ \{}
\DoxyCodeLine{\ \ \ \ //\ command\ did\ not\ work.}
\DoxyCodeLine{\ \ \ \ //\ er\ is\ decorated\ with:}
\DoxyCodeLine{\ \ \ \ //\ -\/\ code}
\DoxyCodeLine{\ \ \ \ //\ -\/\ signal}
\DoxyCodeLine{\ \ \ \ //\ -\/\ stdout}
\DoxyCodeLine{\ \ \ \ //\ -\/\ stderr}
\DoxyCodeLine{\ \ \ \ //\ -\/\ path}
\DoxyCodeLine{\ \ \ \ //\ -\/\ pkgid\ (name@version\ string)}
\DoxyCodeLine{\ \ \ \ //\ -\/\ event}
\DoxyCodeLine{\ \ \ \ //\ -\/\ script}
\DoxyCodeLine{\ \ \})}

\end{DoxyCode}
\hypertarget{README.md_autotoc_md1639}{}\doxysubsection{\texorpdfstring{API}{API}}\label{README.md_autotoc_md1639}
Call the exported {\ttfamily run\+Script} function with an options object.

Returns a promise that resolves to the result of the execution. Promise rejects if the execution fails (exits non-\/zero) or has any other error. Rejected errors are decorated with the same values as the result object.

If the stdio options mean that it\textquotesingle{}ll have a piped stdin, then the stdin is ended immediately on the child process. If stdin is shared with the parent terminal, then it is up to the user to end it, of course.\hypertarget{README.md_autotoc_md1640}{}\doxysubsubsection{\texorpdfstring{Results}{Results}}\label{README.md_autotoc_md1640}

\begin{DoxyItemize}
\item {\ttfamily code} Process exit code
\item {\ttfamily signal} Process exit signal
\item {\ttfamily stdout} stdout data (Buffer, or String when {\ttfamily stdio\+String} set to true)
\item {\ttfamily stderr} stderr data (Buffer, or String when {\ttfamily stdio\+String} set to true)
\item {\ttfamily path} Path to the package executing its script
\item {\ttfamily event} Lifecycle event being run
\item {\ttfamily script} Command being run
\end{DoxyItemize}\hypertarget{README.md_autotoc_md1641}{}\doxysubsubsection{\texorpdfstring{Options}{Options}}\label{README.md_autotoc_md1641}

\begin{DoxyItemize}
\item {\ttfamily path} Required. The path to the package having its script run.
\item {\ttfamily event} Required. The event being executed.
\item {\ttfamily args} Optional, default {\ttfamily \mbox{[}\mbox{]}}. Extra arguments to pass to the script.
\item {\ttfamily env} Optional, object of fields to add to the environment of the subprocess. Note that process.\+env IS inherited by default These are always set\+:
\begin{DoxyItemize}
\item {\ttfamily npm\+\_\+package\+\_\+json} The package.\+json file in the folder
\item {\ttfamily npm\+\_\+lifecycle\+\_\+event} The event that this is being run for
\item {\ttfamily npm\+\_\+lifecycle\+\_\+script} The script being run
\item The {\ttfamily package.\+json} fields described in \href{https://github.com/npm/rfcs/pull/183/files}{\texttt{ RFC183}}.
\end{DoxyItemize}
\item {\ttfamily script\+Shell} Optional, defaults to {\ttfamily /bin/sh} on Unix, defaults to {\ttfamily env.\+Com\+Spec} or {\ttfamily cmd} on Windows. Custom script to use to execute the command.
\item {\ttfamily stdio} Optional, defaults to `\textquotesingle{}pipe'{\ttfamily . The same as the}stdio{\ttfamily argument passed to}child\+\_\+process{\ttfamily functions in Node.\+js. Note that if a stdio output is set to anything other than}pipe{\ttfamily , it will not be present in the result/error object. -\/}cmd{\ttfamily Optional. Override the script from the}package.\+json{\ttfamily with something else, which will be run in an otherwise matching environment. -\/}stdio\+String{\ttfamily Optional, passed directly to}@npmcli/promise-\/spawn{\ttfamily which defaults it to}true{\ttfamily . Return string values for}stderr{\ttfamily and}stdout{\ttfamily rather than Buffers. -\/}banner{\ttfamily Optional, defaults to}true{\ttfamily . If the}stdio{\ttfamily option is set to }\textquotesingle{}inherit\textquotesingle{}{\ttfamily , then print a banner with the package name and version, event name, and script command to be run. Set explicitly to}false\`{} to disable for inherited stdio.
\end{DoxyItemize}

Note that this does {\itshape not} run pre-\/event and post-\/event scripts. The caller has to manage that process themselves.\hypertarget{README.md_autotoc_md1642}{}\doxysubsection{\texorpdfstring{Differences from \href{https://github.com/npm/npm-lifecycle}{\texttt{ npm-\/lifecycle}}}{Differences from \href{https://github.com/npm/npm-lifecycle}{\texttt{ npm-\/lifecycle}}}}\label{README.md_autotoc_md1642}
This is an implementation to satisfy \href{https://github.com/npm/rfcs/pull/90}{\texttt{ RFC 90}}, \href{https://github.com/npm/rfcs/pull/77}{\texttt{ RFC 77}}, and \href{https://github.com/npm/rfcs/pull/73}{\texttt{ RFC 73}}.

Apart from those behavior changes in npm v7, this is also just refresh of the codebase, with modern coding techniques and better test coverage.

Functionally, this means\+:


\begin{DoxyItemize}
\item Output is not dumped to the top level process\textquotesingle{}s stdio by default.
\item Less stuff is put into the environment.
\item It is not opinionated about logging. (So, at least with the logging framework in npm v7.\+0 and before, the caller has to call {\ttfamily log.\+disable\+Progress()} and {\ttfamily log.\+enable\+Progress()} at the appropriate times, if necessary.)
\item The directory containing the {\ttfamily node} executable is {\itshape never} added to the {\ttfamily PATH} environment variable. (Ie, {\ttfamily -\/-\/scripts-\/prepend-\/node-\/path} is effectively always set to {\ttfamily false}.) Doing so causes more unintended side effects than it ever prevented.
\item Hook scripts are not run by this module. If the caller wishes to run hook scripts, then they can override the default package script with an explicit {\ttfamily cmd} option pointing to the {\ttfamily node\+\_\+modules/.hook/\$\{event\}} script.
\end{DoxyItemize}\hypertarget{README.md_autotoc_md1643}{}\doxysubsection{\texorpdfstring{Escaping}{Escaping}}\label{README.md_autotoc_md1643}
In order to ensure that arguments are handled consistently, this module writes a temporary script file containing the command as it exists in the package.\+json, followed by the user supplied arguments having been escaped to ensure they are processed as literal strings. We then instruct the shell to execute the script file, and when the process exits we remove the temporary file.

In Windows, when the shell is cmd, and when the initial command in the script is a known batch file (i.\+e. {\ttfamily something.\+cmd}) we double escape additional arguments so that the shim scripts npm installs work correctly.

The actual implementation of the escaping is in {\ttfamily lib/escape.\+js}. 